# WS2812B パターンLEDコントローラ (Arduino Nano)

このスケッチは、Arduino Nano と WS2812B LED ストリップを使用し、  
2つのセグメントに分けて独立した動きを制御します。

---

## 概要

| 項目 | 内容 |
|------|------|
| ボード | Arduino Nano |
| LEDチップ | WS2812B |
| ライブラリ | Adafruit_NeoPixel |
| LED数 | 108個 (0〜107) |
| 信号ピン | D1 |

---

## 入力ポテンショメータ

| ピン | 用途 | 説明 |
|------|------|------|
| A0 | 明るさ | RGBを直接スケーリング (setBrightness不使用) |
| A1 | 速度 | Segment Aの流れ速度 + Segment Bのフェーズ切替速度 |

---

## セグメント構成

- **Segment A (LED 0〜32)**  
  白と青が交互に流れる「ベルト」状のパターン。  
  - パターンは下記の定数で変更：
    ```cpp
    const int PATTERN_BLOCK = 2; // または 3
    ```
    | 値 | パターン | 説明 |
    |----|-----------|------|
    | 2 | WWBB | 白2個 + 青2個の繰り返し |
    | 3 | WWWBBB | 白3個 + 青3個の繰り返し |

  - 方向は `REVERSE_FLOW` で指定：
    ```cpp
    #define REVERSE_FLOW 1  // 0=右流れ, 1=左流れ
    ```

---

- **Segment B (LED 33〜107)**  
  9つのフェーズを順番に切り替えながら点灯。  
  - フェーズ進行：Phase01 → Phase09 → Phase10(全消灯) → 繰り返し  
  - Phase06 では LED74 のみオレンジで点灯  
  - 他のフェーズは白色で範囲点灯  

---

## 速度・明るさのマッピング

| 対応要素 | 範囲 | 備考 |
|-----------|-------|------|
| 明るさ (A0) | 10〜255 | 0以下でも最低10を保証 |
| フェーズ遅延 (A1) | 5000ms → 300ms | A1の値を線形マップ |
| チェイス遅延 | phaseDelayMs / 8 | 下限20ms, 上限300ms でクランプ |

---

## 特徴

- **非ブロッキング処理**  
  `millis()` ベースで動作し、delayによる停止が発生しません。  
  `delay(10)` は描画の安定化のみ。

- **シンプルなカスタマイズ**
  - PATTERN_BLOCK (2 / 3) を切り替えるだけでパターン変更  
  - REVERSE_FLOW で流れ方向を反転  
  - PHASES 配列を編集してフェーズ範囲を調整可能  

---

## 使い方

1. Arduino IDE または VSCode + PlatformIO で開く  
2. スケッチをアップロード  
3. **A0ノブ**：明るさを調整  
4. **A1ノブ**：流れ・フェーズ速度を調整  
5. PATTERN_BLOCK の値を変更して再コンパイル：
   ```cpp
   const int PATTERN_BLOCK = 3;  // ← 3に変更して再書き込み
